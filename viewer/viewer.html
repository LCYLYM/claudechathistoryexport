<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude对话查看器 🤖</title>
    <link rel="stylesheet" href="viewer.css">
    <!-- Markdown解析库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <!-- 代码高亮库 -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <!-- Mermaid图表库 -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
</head>
<body>
    <div class="viewer-container">
        <!-- 头部导航 -->
        <header class="viewer-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="viewer-title">
                        <span class="title-icon">🤖</span>
                        Claude对话查看器
                    </h1>
                    <div class="viewer-subtitle">支持多分支、Markdown、代码高亮</div>
                </div>
                <div class="header-right">
                    <div class="header-controls">
                        <button class="control-btn" id="load-file-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            加载文件
                        </button>
                        <button class="control-btn" id="tree-view-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8,2H16A2,2 0 0,1 18,4V6A2,2 0 0,1 16,8H8A2,2 0 0,1 6,6V4A2,2 0 0,1 8,2M8,10H16A2,2 0 0,1 18,12V14A2,2 0 0,1 16,16H8A2,2 0 0,1 6,14V12A2,2 0 0,1 8,10M8,18H16A2,2 0 0,1 18,20V22A2,2 0 0,1 16,24H8A2,2 0 0,1 6,22V20A2,2 0 0,1 8,18Z"/>
                            </svg>
                            树形视图
                        </button>
                        <button class="control-btn" id="export-html-btn" disabled>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            导出HTML
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main class="viewer-main">
            <!-- 上传区域 -->
            <div class="upload-area" id="upload-area">
                <div class="upload-content">
                    <div class="upload-icon">📁</div>
                    <h3>拖拽JSON文件到此处</h3>
                    <p>或点击"加载文件"按钮选择文件</p>
                    <div class="upload-formats">
                        支持格式：Claude导出的JSON文件
                    </div>
                </div>
            </div>

            <!-- 加载状态 -->
            <div class="loading-state" id="loading-state" style="display: none;">
                <div class="loading-spinner"></div>
                <div class="loading-text">正在解析对话数据...</div>
            </div>

            <!-- 对话内容 -->
            <div class="conversation-container" id="conversation-container" style="display: none;">
                <!-- 对话信息头部 -->
                <div class="conversation-header" id="conversation-header">
                    <!-- 动态生成 -->
                </div>

                <!-- 分支导航 -->
                <div class="branch-navigation" id="branch-navigation" style="display: none;">
                    <div class="branch-title">🌳 对话分支</div>
                    <div class="branch-tree" id="branch-tree">
                        <!-- 动态生成 -->
                    </div>
                </div>

                <!-- 消息列表 -->
                <div class="messages-container" id="messages-container">
                    <!-- 动态生成 -->
                </div>
            </div>
        </main>

        <!-- 侧边栏 -->
        <aside class="viewer-sidebar" id="viewer-sidebar">
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">📊 统计信息</h3>
                    <div class="stats-grid" id="stats-grid">
                        <!-- 动态生成 -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">🔧 显示选项</h3>
                    <div class="display-options">
                        <label class="option-item">
                            <input type="checkbox" id="show-timestamps" checked>
                            <span class="option-label">显示时间戳</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" id="show-attachments" checked>
                            <span class="option-label">显示附件</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" id="show-tools" checked>
                            <span class="option-label">显示工具使用</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" id="show-metadata" checked>
                            <span class="option-label">显示元数据</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" id="render-markdown" checked>
                            <span class="option-label">渲染Markdown</span>
                        </label>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">🎨 主题设置</h3>
                    <div class="theme-options">
                        <button class="theme-btn active" data-theme="light">浅色</button>
                        <button class="theme-btn" data-theme="dark">深色</button>
                        <button class="theme-btn" data-theme="auto">自动</button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- 侧边栏切换按钮 -->
        <button class="sidebar-toggle" id="sidebar-toggle">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
            </svg>
        </button>
    </div>

    <!-- 文件输入 -->
    <input type="file" id="file-input" accept=".json" style="display: none;">

    <!-- 模态框 -->
    <div class="modal" id="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">标题</h3>
                <button class="modal-close" id="modal-close">×</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 动态内容 -->
            </div>
        </div>
    </div>

    <script src="viewer.js"></script>
    <script>
        // 监听来自测试页面的消息
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'loadData') {
                viewer.loadJsonData(event.data.data);
            }
        });
    </script>
</body>
</html>
